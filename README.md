# Dyslexia Assist (Scaffold)

## Overview
Flutter + Firebase (Auth later) + Cloud Functions + Vertex AI (planned) app to help dyslexia users consume mixed media (PDF/images/text) and generate summaries, explanatory images, audio, and study cards.

## Structure
- `lib/models` Freezed models (run codegen with build_runner)
- `lib/repositories` Firestore abstraction working on map-in-user-doc pattern
- `lib/services` AI / OCR / TTS placeholders
- `lib/view_models` UI state (Provider ChangeNotifiers)
- `lib/pages` Basic routed screens
- `functions/` Cloud Functions TypeScript scaffold
- `.github/copilot-instructions.md` AI agent guidance

## Flutter Dev Quick Start
```bash
flutter pub get
dart run build_runner build --delete-conflicting-outputs
flutter run
```

If you have not configured Firebase yet, generate `lib/firebase_options.dart` using:
```
flutterfire configure --project <your-firebase-project>
```
Until you do, the placeholder options will likely prevent full backend functionality.

Windows note: enable Developer Mode (symlink support) or plugins may fail:
```
start ms-settings:developers
```

## Cloud Functions Quick Start
```bash
cd functions
npm install
npm run build
# Deploy (requires firebase CLI configured & project set):
firebase deploy --only functions
```

Functions are authored purely in TypeScript under `functions/src`. The compiled output in `functions/lib` is generated by `npm run build` and ignored via `.gitignore`.

## Callable Function (Session Pipeline)
Name: `runSessionPipeline`
Payload:
```json
{
	"userId": "user_abc123",
	"sessionId": "session_001"
}
```
Side effects: Updates session document status through phases: `processing -> generatingImages -> complete` (or `error`).
Returns `{ "status": "started" }` immediately.

## AI Integration (Vertex)
Implemented server-side (Functions) using `@google-cloud/vertexai` with graceful fallbacks when env not set.

Required environment variables (set via `firebase functions:config:set` or process env):
```
VERTEX_PROJECT_ID=your-gcp-project
VERTEX_LOCATION=us-central1            # optional, default us-central1
VERTEX_TEXT_MODEL=gemini-1.5-flash     # optional
VERTEX_IMAGE_MODEL=imagen-3.0-generate # optional
```
If `VERTEX_PROJECT_ID` is missing the pipeline uses stubbed outputs (truncated text summary, dummy terms, no images).

Image generation produces base64 which is uploaded to Firebase Storage under `/{userId}/{sessionId}/generated/` and then signed URLs are stored in `sessions.{sessionId}.imgExplanations`.

## Current Roadmap
1. Client-side AI service alignment (optional local prompt caching).
2. Authentication integration & securing callable function.
3. Enhanced error resiliency (retries, partial progress preservation).
4. Memory game feature build-out.
5. Accessibility polish (voice prompts, adjustable speech rate already scaffolded).

## Code Generation
Run build_runner after model changes:
```bash
dart run build_runner watch --delete-conflicting-outputs
```

## Data Model
See `database-sample.json` and `.github/copilot-instructions.md` for Firestore map structure.

## Notes
- Vertex integration now live in Functions pipeline.
- Fallback stubs keep dev flow unblocked without credentials.
- Migrate to sub-collections when entity counts grow large.
